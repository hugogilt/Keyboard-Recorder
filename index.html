<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keyboard Capture</title>
    <style>
        /* Estilo para el círculo rojo */
        #circle {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: red;
            color: white;
            text-align: center;
            line-height: 60px;
            font-size: 14px;
            font-weight: bold;
            display: none;
            z-index: 9999;
        }

        @keyframes blinking {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        .circle-blink {
            animation: blinking 1s infinite;
        }
    </style>
</head>
<body>
    <div id="circle">REC</div>

    <input type="text" placeholder="Prueba aquí el teclado" style="width: 300px; margin: 20px; padding: 10px;">

    <p>
        <strong>Instrucciones:</strong><br>
        - Usa <kbd>Command + 0</kbd> (Mac) o <kbd>Control + 0</kbd> (Windows) para iniciar/detener la captura de teclado.<br>
        - Mientras capturas, cada tecla válida se añadirá a la variable y al portapapeles.<br>
        - Al detener la captura, la última secuencia de teclas quedará guardada en el portapapeles.<br>
        - Pegar también detendrá la captura.
    </p>

    <script>
        const circle = document.getElementById('circle');

        let capturingKeys = false;
        let capturedKeys = '';

        // Teclas que deben ser ignoradas siempre
        const ignoredKeys = ['Tab', 'CapsLock', 'Escape'];

        // Iniciar o detener captura
        document.addEventListener('keydown', function (e) {
            // Si se presiona Ctrl/Cmd + 0, alternar captura
            if ((e.metaKey || e.ctrlKey) && e.key === '0') {
                e.preventDefault(); // Prevenir comportamiento predeterminado
                capturingKeys = !capturingKeys;

                if (capturingKeys) {
                    capturedKeys = ''; // Reiniciar la variable
                    circle.style.display = 'block'; // Mostrar el círculo
                    circle.classList.add('circle-blink'); // Añadir animación
                } else {
                    stopCapturing();
                }
            }

            // Ignorar las teclas no deseadas
            if (ignoredKeys.includes(e.key)) {
                return;
            }

            // Capturar teclas válidas durante la grabación
            if (capturingKeys && !e.metaKey && !e.ctrlKey && !e.altKey && !e.shiftKey) {
                if (e.key === 'Backspace') {
                    // Borrar el último carácter de la variable
                    capturedKeys = capturedKeys.slice(0, -1);
                } else if (e.key === 'Enter') {
                    // Agregar un salto de línea
                    capturedKeys += '\n';
                } else {
                    // Agregar la tecla a la variable
                    capturedKeys += e.key;
                }

                // Actualizar el portapapeles
                copyToClipboard(capturedKeys);
            }

            // Si se presiona Ctrl/Cmd + V, detener captura
            if (capturingKeys && (e.metaKey || e.ctrlKey) && e.key === 'v') {
                stopCapturing();
            }
        });

        // Detener captura
        function stopCapturing() {
            capturingKeys = false;
            circle.style.display = 'none'; // Ocultar el círculo
            circle.classList.remove('circle-blink'); // Detener animación
            console.log('Captura finalizada. Texto guardado en el portapapeles:', capturedKeys);
        }

        // Copiar texto al portapapeles
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                console.log('Texto actualizado en el portapapeles:', text);
            });
        }
    </script>
</body>
</html>
